<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“ JSONBin Note</title>
  <style>
    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
    }
    #status {
      margin-top: 10px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>ğŸ“ JSONBin Note</h1>
  <div id="status">â³ Loading...</div>
  <textarea id="note" placeholder="Start typing..."></textarea>

  <script>
    const API_KEY = '$2a$10$qVOWTiPggbYV3jCnVcWIn.6j5qZdBQUtzynBHEu5CkhwJtieHmvMa';
    const BIN_ID = '6875d986271ee80cc5fbb5ba';
    const URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    const status = document.getElementById('status');
    const textarea = document.getElementById('note');
    let lastSaved = "";
    let debounceTimer = null;

    // Load existing note from bin
    async function loadNote() {
      try {
        const res = await fetch(URL, {
          headers: { 'X-Master-Key': API_KEY }
        });
        const data = await res.json();
        textarea.value = data.record.text || '';
        lastSaved = textarea.value;
        status.textContent = "âœ… Loaded";
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Failed to load";
      }
    }

    // Save current note to bin
    async function saveNote(content) {
      try {
        await fetch(URL, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': API_KEY
          },
          body: JSON.stringify({ text: content })
        });
        status.textContent = "âœ… Saved at " + new Date().toLocaleTimeString();
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Failed to save";
      }
    }

    // Auto-save on pause
    textarea.addEventListener('input', () => {
      status.textContent = "ğŸ’¾ Saving...";
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const current = textarea.value;
        if (current !== lastSaved) {
          saveNote(current);
          lastSaved = current;
        }
      }, 2000); // Save after 2s of no typing
    });

    loadNote(); // Load on page load
  </script>
</body>
</html>
